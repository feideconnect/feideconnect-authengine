{# -*- mode: web; web-mode-markup-indent-offset: 2 -*- #}


{# For every requestor (grouped by org and owner if not org) list information
about the requestor and all permissions requested #}

{% for requestor, permlist in perms.views %}

  {% set requestorInfo = attribute(perms.requestorInfo, requestor) %}

  {# If the requestor is a user #}
  {% if requestorInfo.userid %}
    <div class="media with-logo">
      <div class="media-left">
        <img src="{{apibase}}/userinfo/v1/user/media/{{ requestorInfo.profilephoto }}" />
      </div>
      <div class="media-body media-middle">
        <h1>
          {{ requestorInfo.name }}
        </h1>
      </div>
    </div>
  {% endif %}

  {# If the requestor is an organization #}
  {% if requestorInfo.id %}
    <div class="media with-logo">
      <div class="media-left">
        <img src="{{ requestorInfo.logoURL }}" />
      </div>
      <div class="media-body media-middle">
        <h1>
          {{ requestorInfo.name.nb }}
        </h1>
      </div>
    </div>
  {% endif %}

  {# List all permissions requested #}
  {% for perm in permlist %}
    <div class="list-group-item">
      <p>
        {% if perm.icon %}
          <span style="color: #565" class="fa fa-fw fa-{{ perm.icon }}"></span>
        {% endif %}
        {{ perm.title }}
      </p>

      {% if perm.descr %}
        <small>{{ perm.descr }}</small>
      {% endif %}

      {% if perm.expandable %}
        <div class="hide">
          <ul class="grant-item-list">
            {% for item in perm.items %}
              <li>
                {% if item.icon %}
                  <span class="fa fa-fw fa-{{ item.icon }}"></span>
                {% endif %}
                {{ item.title }}
              </li>
            {% endfor %}
          </ul>
        </div>
      {% endif %}

    </div>
  {% endfor %}

  {# List API info #}
  {% set apis = attribute(perms.apiInfo, requestor) %}
  {% if apis %}
    <div class="list-group-item">
      APIs
      <ul style="margin: 0;">
        {% for api in apis %}
          <li>{{ api.name }}</li>
        {% endfor %}
      </ul>
    </div>
  {% endif %}

{% endfor %}
