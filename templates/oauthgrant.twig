{# -*- mode: web; web-mode-markup-indent-offset: 2 -*- #}
{% extends "base.twig" %}

{% block head %}

  {% if isDevelopment == 'dev' %}
    <link type="text/css" href="/static/css/grant.css" rel="stylesheet" />
  {% else %}
    <link href="/static/build/style.min.css?bust={{cacheBust}}" rel="stylesheet" />
  {% endif %}

{% endblock %}


{% block scripts %}
  {% if isDevelopment == 'dev' %}
    <script>
     var visualTag = {{visualTag|raw}};
    </script>
    <script>require(['oauthgrant/main'])</script>
  {% endif %}
{% endblock %}


{% block content %}

  <!-- NOSCRIPT -->
  <noscript>
    <form id="login2" method="post" action="{{posturl}}" style="padding: 3em">
      {% if postdata %}
        <input type="hidden" name="{{key}}" value="{{value}}" />
      {% endif %}
      <p>Turn on javascript to review terms of use.</p>
      <button type="submit" id="actAcceptBrVilk2" class="btn btn-primary">Accept Dataporten terms of use and authorize application</button>
    </form>
  </noscript>

  <div id="mcontent">

    <!-- Media object for user -->
    <div class="media grantDetails">
      <div class="media-left" href="#">
        <img class="profileImage" src="{{apibase}}/userinfo/v1/user/media/{{user.p}}" alt="User Profile photo" />
      </div>
      <div class="media-body media-middle">
        <h1 class="media-heading">
          {{user.name}}
        </h1>

        <p class="org">
          {{organization}}
        </p>

      </div><!-- media-body -->
    </div><!-- media -->


    <form  id="login" method="post" action="{{posturl}}">
      <div class="container mainContainer" >

        <div class="row uninett-padded">


          <div class="col-md-12" style=" ">

            {% set firsttime = true %}
            {% if firsttime %}
              {% include 'partials/grant_firsttime.twig' %}
            {% endif %}

            <div id="servicecontent">
              {# INCLUDE {{> grant.service}} #}
              <p class="simpleSkip">{{_.requestsperms}}</p>

              <div class="list-group simpleSkip" id="grantpermissionlist">
                {# INCLUDE {{> grant.perms}} #}
                {# INCLUDE {{> grant.perms-apis}} #}
              </div><!-- End of list-group -->

              {% if permsLongTerm %}
                <p class="simpleSkip" style="margin-top: 0px"><i class="fa fa-clock-o" aria-hidden="true"></i> {{_.permlong|raw}}</p>
              {% else %}
                <p class="simpleSkip"><i class="fa fa-clock-o" aria-hidden="true"></i> {{_.permshort|raw}}</p>
              {% endif %}

              <div class="center-block simpleSkip" >
                <p>{{_.doyouaccept}}</p>
              </div>

              {% if postdata %}
                <input type="hidden" name="{{key}}" value="{{value}}" />
              {% endif %}

              <div class="center-block simpleSkip" style="" >
                <fieldset id="actions" style=" text-align: center; margin-bottom: 5px ">
                <button type="submit" id="submit" tabindex="1" class="btn btn-default reqAccept">
                <span class="glyphicon glyphicon-ok"></span>
                {{_.yes}}
                  </button>
                <a tabindex="2" class="btn btn-default" href="/reject">
                <span class="glyphicon glyphicon-remove"></span>
                {{_.no}}
                  </a>
                </fieldset>
              </div>

              <div class="center-block simpleOnly" style="margin-top: 2em" >

                <fieldset id="actions" style=" text-align: right ">

                <a tabindex="2" class="btn btn-default tglSimple" href="#">
                <span class="glyphicon glyphicon-chevron-down"></span>
                {{_.showmore}}
                  </a>

                <button type="submit" id="submit" tabindex="1" class="btn btn-success reqAccept">
                <span class="glyphicon glyphicon-chevron-right"></span>
                {{_.okcontinue}}
                  </button>

                </fieldset>
              </div>

            </div>

          </div><!-- column -->
        </div><!-- row -->
      </div><!-- container -->

      <div class="container" style="color: #bba; margin-top: 4em;" >
        <p style="text-align: right; font-size: 80%; margin-bottom: 0px; padding-bottom: 0px">
          <a target="_blank" href="http://docs.dataporten.no/docs/endusers/">
            {{_.readmoreconnect}}
            <i class="fa fa-chevron-left"></i>
          </a>
        </p>
        <p style="text-align: right; font-size: 80%; margin-top: 0px; padding-top: 0px">
          <a target="_blank" href="https://auth.dataporten.no/tou/generic">
            {{_.connectpersonvern}}
            <i class="fa fa-chevron-left"></i>
          </a>
        </p>
      </div>

    </form>

    <!-- Modal for privacy policy -->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel">{{_.userterms}}</h4>
          </div>
          <div id="tousection" class="modal-body">
            {# INCLUDE {{> grant.bruksvilkar}} #}
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">{{_.close}}</button>
          </div>
        </div>
      </div>
    </div>

  </div>

{% endblock %}
